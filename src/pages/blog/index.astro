---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const posts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  });
}
---

<BaseLayout title="Blog" description="All blog posts">
  <h1 style="font-size: 2rem; margin-bottom: 2rem;">All Posts</h1>

  {posts.length === 0 ? (
    <p style="color: var(--color-text-muted);">No posts yet.</p>
  ) : (
    <ul style="list-style: none;">
      {posts.map((post) => (
        <li style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--color-border);">
          <a href={`/blog/${post.slug}`} style="font-size: 1.125rem; font-weight: 500;">
            {post.data.title}
          </a>
          <div style="color: var(--color-text-muted); font-size: 0.875rem; margin-top: 0.25rem;">
            <time datetime={post.data.pubDate.toISOString()}>{formatDate(post.data.pubDate)}</time>

          </div>
          <p style="margin-top: 0.5rem; color: var(--color-text-muted);">
            {post.data.description}
          </p>
        </li>
      ))}
    </ul>
  )}
</BaseLayout>
